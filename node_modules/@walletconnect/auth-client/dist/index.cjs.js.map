{"version":3,"file":"index.cjs.js","sources":["../src/types/engine.ts","../src/types/client.ts","../src/constants/defaults.ts","../src/constants/engine.ts","../src/constants/client.ts","../src/constants/expirer.ts","../src/utils/address.ts","../src/utils/store.ts","../src/utils/validators.ts","../src/utils/signature.ts","../src/controllers/engine.ts","../src/client.ts","../src/utils/crypto.ts","../src/index.ts"],"sourcesContent":["import { RelayerTypes, CryptoTypes } from \"@walletconnect/types\";\n\nimport {\n  ErrorResponse as CommonErrorResponse,\n  JsonRpcError,\n  JsonRpcRequest,\n  JsonRpcResponse,\n  JsonRpcResult,\n} from \"@walletconnect/jsonrpc-utils\";\nimport { AuthClientTypes, IAuthClient } from \"./client\";\nimport { JsonRpcTypes } from \"./jsonrpc\";\n\nexport interface RpcOpts {\n  req: RelayerTypes.PublishOptions;\n  res: RelayerTypes.PublishOptions;\n}\n\nexport declare namespace AuthEngineTypes {\n  interface EventCallback<T extends JsonRpcRequest | JsonRpcResponse> {\n    topic: string;\n    payload: T;\n  }\n\n  // https://github.com/ChainAgnostic/CAIPs/pull/74\n  interface RequestParams {\n    chainId: string;\n    domain: string;\n    nonce: string;\n    aud: string;\n    type?: CacaoHeader[\"t\"];\n    nbf?: string;\n    exp?: string;\n    statement?: string;\n    requestId?: string;\n    resources?: string[];\n  }\n\n  interface PayloadParams {\n    type: CacaoHeader[\"t\"];\n    chainId: string;\n    domain: string;\n    aud: string;\n    version: string;\n    nonce: string;\n    iat: string;\n    nbf?: string;\n    exp?: string;\n    statement?: string;\n    requestId?: string;\n    resources?: string[];\n  }\n\n  interface CacaoPayload {\n    iss: string;\n    domain: string;\n    aud: string;\n    version: string;\n    nonce: string;\n    iat: string;\n    nbf?: string;\n    exp?: string;\n    statement?: string;\n    requestId?: string;\n    resources?: string[];\n  }\n\n  interface CacaoHeader {\n    t: \"eip4361\";\n  }\n\n  interface CacaoSignature {\n    t: \"eip191\" | \"eip1271\";\n    s: string;\n    m?: string;\n  }\n\n  interface Cacao {\n    h: CacaoHeader;\n    p: CacaoPayload;\n    s: CacaoSignature;\n  }\n\n  interface PendingRequest {\n    id: number;\n    requester: {\n      publicKey: string;\n      metadata: AuthClientTypes.Metadata;\n    };\n    cacaoPayload: CacaoPayload;\n    message: string;\n  }\n\n  interface ResultResponse {\n    id: number;\n    signature: CacaoSignature;\n  }\n\n  interface ErrorResponse {\n    id: number;\n    error: CommonErrorResponse;\n  }\n\n  type RespondParams = ResultResponse | ErrorResponse;\n}\n\nexport abstract class IAuthEngine {\n  constructor(public client: IAuthClient) {}\n\n  public abstract init(): void;\n\n  public abstract request(\n    params: AuthEngineTypes.RequestParams,\n    opts?: { topic?: string },\n  ): Promise<{ uri: string; id: number }>;\n\n  public abstract respond(params: AuthEngineTypes.RespondParams): Promise<void>;\n\n  public abstract getPendingRequests(): Record<number, AuthEngineTypes.PendingRequest>;\n\n  // ---------- Protected Helpers --------------------------------------- //\n\n  protected abstract sendRequest<M extends JsonRpcTypes.WcMethod>(\n    topic: string,\n    method: M,\n    params: JsonRpcTypes.RequestParams[M],\n    encodeOpts?: CryptoTypes.EncodeOptions,\n  ): Promise<number>;\n\n  protected abstract sendResult<M extends JsonRpcTypes.WcMethod>(\n    id: number,\n    topic: string,\n    result: JsonRpcTypes.Results[M],\n    encodeOpts?: CryptoTypes.EncodeOptions,\n  ): Promise<number>;\n\n  protected abstract sendError(\n    id: number,\n    topic: string,\n    error: AuthEngineTypes.ErrorResponse,\n    opts?: CryptoTypes.EncodeOptions,\n  ): Promise<number>;\n\n  protected abstract setExpiry(topic: string, expiry: number): Promise<void>;\n\n  // ---------- Protected Relay Event Methods ----------------------------------- //\n\n  protected abstract onRelayEventRequest(\n    event: AuthEngineTypes.EventCallback<JsonRpcRequest>,\n  ): void;\n\n  protected abstract onRelayEventResponse(\n    event: AuthEngineTypes.EventCallback<JsonRpcResponse>,\n  ): Promise<void>;\n\n  // ---------- Protected Relay Event Handlers --------------------------------- //\n\n  protected abstract onAuthRequest(\n    topic: string,\n    payload: JsonRpcRequest<JsonRpcTypes.RequestParams[\"wc_authRequest\"]>,\n  ): Promise<void>;\n\n  protected abstract onAuthResponse(\n    topic: string,\n    payload: JsonRpcResult<JsonRpcTypes.Results[\"wc_authRequest\"]> | JsonRpcError,\n  ): void;\n}\n","import { ICore, IStore, CoreTypes } from \"@walletconnect/types\";\nimport EventEmitter from \"events\";\nimport { Logger } from \"pino\";\nimport { AuthEngineTypes } from \"./engine\";\n\nimport { IAuthEngine } from \"../types\";\nimport { JsonRpcError, JsonRpcResult } from \"@walletconnect/jsonrpc-utils\";\n\nexport declare namespace AuthClientTypes {\n  type Event = \"auth_request\" | \"auth_response\";\n\n  interface AuthRequestEventArgs {\n    requester: AuthEngineTypes.PendingRequest[\"requester\"];\n    message: string;\n  }\n\n  type AuthResponseEventArgs =\n    | { message: string; code: number }\n    | JsonRpcResult<AuthEngineTypes.Cacao>\n    | JsonRpcError;\n\n  interface BaseEventArgs<T = unknown> {\n    id: number;\n    topic: string;\n    params: T;\n  }\n\n  interface EventArguments {\n    auth_request: BaseEventArgs<AuthRequestEventArgs>;\n    auth_response: BaseEventArgs<AuthResponseEventArgs>;\n  }\n\n  interface Options extends CoreTypes.Options {\n    metadata: Metadata;\n    core?: ICore;\n    iss?: string;\n    projectId: string;\n  }\n\n  interface Metadata {\n    name: string;\n    description: string;\n    url: string;\n    icons: string[];\n    redirect?: {\n      native?: string;\n      universal?: string;\n    };\n  }\n}\n\nexport abstract class IAuthClient {\n  public abstract readonly protocol: string;\n  public abstract readonly version: number;\n  public abstract readonly name: string;\n\n  public abstract core: ICore;\n  public abstract metadata: AuthClientTypes.Metadata;\n  public abstract address?: string;\n  public abstract projectId: string;\n  public abstract authKeys: IStore<string, { publicKey: string }>;\n  public abstract pairingTopics: IStore<string, any>;\n  public abstract requests: IStore<\n    number,\n    { id: number } & (AuthEngineTypes.Cacao | AuthEngineTypes.PendingRequest)\n  >;\n\n  public abstract events: EventEmitter;\n  public abstract logger: Logger;\n  public abstract engine: IAuthEngine;\n\n  constructor(public opts: AuthClientTypes.Options) {}\n\n  // ---------- Public Methods ----------------------------------------------- //\n\n  public abstract request: IAuthEngine[\"request\"];\n  public abstract respond: IAuthEngine[\"respond\"];\n  public abstract getPendingRequests: IAuthEngine[\"getPendingRequests\"];\n\n  // ---------- Event Handlers ----------------------------------------------- //\n\n  public abstract emit: <E extends AuthClientTypes.Event>(\n    event: E,\n    args: AuthClientTypes.EventArguments[E],\n  ) => boolean;\n\n  public abstract on: <E extends AuthClientTypes.Event>(\n    event: E,\n    listener: (args: AuthClientTypes.EventArguments[E]) => void,\n  ) => EventEmitter;\n\n  public abstract once: <E extends AuthClientTypes.Event>(\n    event: E,\n    listener: (args: AuthClientTypes.EventArguments[E]) => void,\n  ) => EventEmitter;\n\n  public abstract off: <E extends AuthClientTypes.Event>(\n    event: E,\n    listener: (args: AuthClientTypes.EventArguments[E]) => void,\n  ) => EventEmitter;\n\n  public abstract removeListener: <E extends AuthClientTypes.Event>(\n    event: E,\n    listener: (args: AuthClientTypes.EventArguments[E]) => void,\n  ) => EventEmitter;\n}\n","export const DEFAULT_RPC_URL = \"https://rpc.walletconnect.com/v1\";\n","import { ONE_DAY } from \"@walletconnect/time\";\nimport { JsonRpcTypes, RpcOpts } from \"../types\";\n\nexport const ENGINE_RPC_OPTS: Record<JsonRpcTypes.WcMethod, RpcOpts> = {\n  wc_authRequest: {\n    req: {\n      ttl: ONE_DAY,\n      prompt: true,\n      tag: 3000,\n    },\n    res: {\n      ttl: ONE_DAY,\n      prompt: false,\n      tag: 3001,\n    },\n  },\n};\n","export const AUTH_CLIENT_PROTOCOL = \"wc\";\nexport const AUTH_CLIENT_VERSION = 1;\nexport const AUTH_CLIENT_CONTEXT = \"auth\";\nexport const AUTH_CLIENT_DEFAULT_NAME = \"authClient\";\n\nexport const AUTH_CLIENT_STORAGE_PREFIX = `${AUTH_CLIENT_PROTOCOL}@${AUTH_CLIENT_VERSION}:${AUTH_CLIENT_CONTEXT}:`;\nexport const AUTH_CLIENT_PUBLIC_KEY_NAME = `${AUTH_CLIENT_STORAGE_PREFIX}:PUB_KEY`;\n","import { ONE_DAY } from \"@walletconnect/time\";\n\nexport const EXPIRER_CONTEXT = \"expirer\";\n\nexport const EXPIRER_EVENTS = {\n  created: \"expirer_created\",\n  deleted: \"expirer_deleted\",\n  expired: \"expirer_expired\",\n  sync: \"expirer_sync\",\n};\n\nexport const EXPIRER_STORAGE_VERSION = \"0.3\";\n\nexport const EXPIRER_DEFAULT_TTL = ONE_DAY;\n","export function getDidAddressSegments(iss: string) {\n  return iss?.split(\":\");\n}\n\nexport function getDidChainId(iss: string) {\n  const segments = iss && getDidAddressSegments(iss);\n  if (segments) {\n    return segments[3];\n  }\n  return undefined;\n}\n\nexport function getNamespacedDidChainId(iss: string) {\n  const segments = iss && getDidAddressSegments(iss);\n  if (segments) {\n    return segments[2] + \":\" + segments[3];\n  }\n  return undefined;\n}\n\nexport function getDidAddress(iss: string) {\n  const segments = iss && getDidAddressSegments(iss);\n  if (segments) {\n    return segments.pop();\n  }\n  return undefined;\n}\n","import { AuthEngineTypes, IAuthClient } from \"../types\";\n\nexport function getPendingRequests(store: IAuthClient[\"requests\"]) {\n  return store.getAll().filter((request) => \"requester\" in request) as ({\n    id: number;\n  } & AuthEngineTypes.PendingRequest)[];\n}\n\nexport function getCompleteRequests(store: IAuthClient[\"requests\"]) {\n  return store.getAll().filter((request) => !(\"requester\" in request)) as ({\n    id: number;\n  } & AuthEngineTypes.Cacao)[];\n}\n\nexport function getPendingRequest(store: IAuthClient[\"requests\"], id: number) {\n  return getPendingRequests(store).find(\n    (request) => request.id === id,\n  ) as AuthEngineTypes.PendingRequest;\n}\n\nexport function getCompleteResponse(store: IAuthClient[\"requests\"], id: number) {\n  return getCompleteRequests(store).find((request) => request.id === id) as AuthEngineTypes.Cacao;\n}\n","import { IStore } from \"@walletconnect/types\";\nimport { isValidUrl } from \"@walletconnect/utils\";\nimport { AuthEngineTypes } from \"../types\";\nimport { getPendingRequest } from \"./store\";\n\nexport function isValidRequest(params: AuthEngineTypes.RequestParams): boolean {\n  const validAudience = isValidUrl(params.aud);\n  // FIXME: disabling this temporarily since it's failing expected values like `chainId: \"1\"`\n  // const validChainId = isValidChainId(params.chainId);\n  const domainInAud = new RegExp(`${params.domain}`).test(params.aud);\n  const hasNonce = !!params.nonce;\n  const hasValidType = params.type ? params.type === \"eip4361\" : true;\n\n  return !!(validAudience /*&& validChainId*/ && domainInAud && hasNonce && hasValidType);\n}\n\nexport function isValidRespond(\n  params: AuthEngineTypes.RespondParams,\n  pendingResponses: IStore<number, any>,\n): boolean {\n  const validId = getPendingRequest(pendingResponses, params.id);\n\n  return !!validId;\n}\n","import { hashMessage } from \"@ethersproject/hash\";\nimport { recoverAddress } from \"@ethersproject/transactions\";\nimport fetch from \"isomorphic-unfetch\";\n\nimport { AuthEngineTypes } from \"../types\";\nimport { DEFAULT_RPC_URL } from \"../constants/defaults\";\n\nexport async function verifySignature(\n  address: string,\n  reconstructedMessage: string,\n  cacaoSignature: AuthEngineTypes.CacaoSignature,\n  chainId: string,\n  projectId: string,\n): Promise<boolean> {\n  // Determine if this signature is from an EOA or a contract.\n  switch (cacaoSignature.t) {\n    case \"eip191\":\n      return isValidEip191Signature(address, reconstructedMessage, cacaoSignature.s);\n    case \"eip1271\":\n      return await isValidEip1271Signature(\n        address,\n        reconstructedMessage,\n        cacaoSignature.s,\n        chainId,\n        projectId,\n      );\n    default:\n      throw new Error(\n        `verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${cacaoSignature.t}`,\n      );\n  }\n}\n\nfunction isValidEip191Signature(address: string, message: string, signature: string): boolean {\n  const recoveredAddress = recoverAddress(hashMessage(message), signature);\n  return recoveredAddress.toLowerCase() === address.toLowerCase();\n}\n\nasync function isValidEip1271Signature(\n  address: string,\n  reconstructedMessage: string,\n  signature: string,\n  chainId: string,\n  projectId: string,\n) {\n  try {\n    const eip1271MagicValue = \"0x1626ba7e\";\n    const dynamicTypeOffset = \"0000000000000000000000000000000000000000000000000000000000000040\";\n    const dynamicTypeLength = \"0000000000000000000000000000000000000000000000000000000000000041\";\n    const nonPrefixedSignature = signature.substring(2);\n    const nonPrefixedHashedMessage = hashMessage(reconstructedMessage).substring(2);\n\n    const data =\n      eip1271MagicValue +\n      nonPrefixedHashedMessage +\n      dynamicTypeOffset +\n      dynamicTypeLength +\n      nonPrefixedSignature;\n\n    const response = await fetch(`${DEFAULT_RPC_URL}/?chainId=${chainId}&projectId=${projectId}`, {\n      method: \"POST\",\n      body: JSON.stringify({\n        id: generateJsonRpcId(),\n        jsonrpc: \"2.0\",\n        method: \"eth_call\",\n        params: [{ to: address, data }, \"latest\"],\n      }),\n    });\n    const { result } = await response.json();\n\n    if (!result) return false;\n\n    // Remove right-padded zeros from result to get only the concrete recovered value.\n    const recoveredValue = result.slice(0, eip1271MagicValue.length);\n    return recoveredValue.toLowerCase() === eip1271MagicValue.toLowerCase();\n  } catch (error: any) {\n    console.error(\"isValidEip1271Signature: \", error);\n    return false;\n  }\n}\n\nfunction generateJsonRpcId() {\n  return Date.now() + Math.floor(Math.random() * 1000);\n}\n","import { RELAYER_EVENTS, RELAYER_DEFAULT_PROTOCOL } from \"@walletconnect/core\";\nimport {\n  formatJsonRpcRequest,\n  formatJsonRpcResult,\n  formatJsonRpcError,\n  isJsonRpcRequest,\n  isJsonRpcResponse,\n  isJsonRpcResult,\n  isJsonRpcError,\n} from \"@walletconnect/jsonrpc-utils\";\nimport { FIVE_MINUTES } from \"@walletconnect/time\";\nimport { RelayerTypes } from \"@walletconnect/types\";\nimport {\n  calcExpiry,\n  generateRandomBytes32,\n  getInternalError,\n  hashKey,\n  TYPE_1,\n  formatUri,\n} from \"@walletconnect/utils\";\nimport { JsonRpcTypes, IAuthEngine, AuthEngineTypes } from \"../types\";\nimport { AUTH_CLIENT_PUBLIC_KEY_NAME, ENGINE_RPC_OPTS } from \"../constants\";\nimport { getDidAddress, getDidChainId, getNamespacedDidChainId } from \"../utils/address\";\nimport { getPendingRequest, getPendingRequests } from \"../utils/store\";\nimport { isValidRequest, isValidRespond } from \"../utils/validators\";\nimport { verifySignature } from \"../utils/signature\";\n\nexport class AuthEngine extends IAuthEngine {\n  private initialized = false;\n  public name = \"authEngine\";\n\n  constructor(client: IAuthEngine[\"client\"]) {\n    super(client);\n  }\n\n  public init: IAuthEngine[\"init\"] = () => {\n    if (!this.initialized) {\n      this.registerRelayerEvents();\n      this.client.core.pairing.register({ methods: Object.keys(ENGINE_RPC_OPTS) });\n      this.initialized = true;\n    }\n  };\n\n  // ---------- Public ------------------------------------------------ //\n\n  public request: IAuthEngine[\"request\"] = async (params, opts) => {\n    this.isInitialized();\n\n    if (!isValidRequest(params)) {\n      throw new Error(\"Invalid request\");\n    }\n\n    // SPEC: A will construct an authentication request.\n    const { chainId, statement, aud, domain, nonce, type } = params;\n\n    const hasKnownPairing =\n      Boolean(opts?.topic) &&\n      this.client.core.pairing.pairings\n        .getAll({ active: true })\n        .some((pairing) => pairing.topic === opts?.topic);\n\n    const relay = { protocol: RELAYER_DEFAULT_PROTOCOL };\n\n    const expiry = calcExpiry(FIVE_MINUTES);\n\n    const publicKey = await this.client.core.crypto.generateKeyPair();\n\n    if (hasKnownPairing) {\n      const knownPairing = this.client.core.pairing.pairings\n        .getAll({ active: true })\n        .find((pairing) => pairing.topic === opts?.topic);\n\n      if (!knownPairing)\n        throw new Error(`Could not find pairing for provided topic ${opts?.topic}`);\n\n      // Send request to existing pairing\n      await this.sendRequest(knownPairing.topic, \"wc_authRequest\", {\n        payloadParams: {\n          type: type ?? \"eip4361\",\n          chainId,\n          statement,\n          aud,\n          domain,\n          version: \"1\",\n          nonce,\n          iat: new Date().toISOString(),\n        },\n        requester: { publicKey, metadata: this.client.metadata },\n      });\n\n      this.client.logger.debug(\"sent request to existing pairing\");\n    }\n\n    const symKey = generateRandomBytes32();\n\n    const pairingTopic = await this.client.core.crypto.setSymKey(symKey);\n\n    // Preparing pairing URI\n    const pairing = { topic: pairingTopic, expiry, relay, active: false };\n    await this.client.core.pairing.pairings.set(pairingTopic, pairing);\n\n    this.client.logger.debug(\"Generated new pairing\", pairing);\n\n    this.setExpiry(pairingTopic, expiry);\n\n    this.client.authKeys.set(AUTH_CLIENT_PUBLIC_KEY_NAME, { publicKey });\n\n    const responseTopic = hashKey(publicKey);\n\n    await this.client.pairingTopics.set(responseTopic, { pairingTopic });\n\n    // Subscribe to the pairing topic (for pings)\n    await this.client.core.relayer.subscribe(pairingTopic);\n    // Subscribe to auth_response topic\n    await this.client.core.relayer.subscribe(responseTopic);\n\n    this.client.logger.debug(\"sending request to potential pairing\");\n\n    // SPEC: A encrypts reuqest with symKey S\n    // SPEC: A publishes encrypted request to topic\n    const id = await this.sendRequest(pairingTopic, \"wc_authRequest\", {\n      payloadParams: {\n        type: type ?? \"eip4361\",\n        chainId,\n        statement,\n        aud,\n        domain,\n        version: \"1\",\n        nonce,\n        iat: new Date().toISOString(),\n      },\n      requester: { publicKey, metadata: this.client.metadata },\n    });\n\n    this.client.logger.debug(\"sent request to potential pairing\");\n\n    const uri = formatUri({\n      protocol: this.client.protocol,\n      version: this.client.core.version,\n      topic: pairingTopic,\n      symKey,\n      relay,\n    });\n\n    return { uri, id };\n  };\n\n  public respond: IAuthEngine[\"respond\"] = async (respondParams) => {\n    this.isInitialized();\n\n    if (!isValidRespond(respondParams, this.client.requests)) {\n      throw new Error(\"Invalid response\");\n    }\n\n    const pendingRequest = getPendingRequest(this.client.requests, respondParams.id);\n\n    const receiverPublicKey = pendingRequest.requester.publicKey;\n    const senderPublicKey = await this.client.core.crypto.generateKeyPair();\n    const responseTopic = hashKey(receiverPublicKey);\n    const encodeOpts = {\n      type: TYPE_1,\n      receiverPublicKey,\n      senderPublicKey,\n    };\n\n    if (\"error\" in respondParams) {\n      await this.sendError(pendingRequest.id, responseTopic, respondParams, encodeOpts);\n      return;\n    }\n\n    const cacao: AuthEngineTypes.Cacao = {\n      h: {\n        t: \"eip4361\",\n      },\n      p: pendingRequest.cacaoPayload,\n      s: respondParams.signature,\n    };\n\n    const id = await this.sendResult<\"wc_authRequest\">(\n      pendingRequest.id,\n      responseTopic,\n      cacao,\n      encodeOpts,\n    );\n\n    await this.client.requests.set(id, { id, ...cacao });\n  };\n\n  public getPendingRequests: IAuthEngine[\"getPendingRequests\"] = () => {\n    const pendingRequests = getPendingRequests(this.client.requests);\n    return pendingRequests;\n  };\n\n  // ---------- Private Helpers --------------------------------------- //\n\n  protected setExpiry: IAuthEngine[\"setExpiry\"] = async (topic, expiry) => {\n    if (this.client.core.pairing.pairings.keys.includes(topic)) {\n      await this.client.core.pairing.updateExpiry({ topic, expiry });\n    }\n    this.client.core.expirer.set(topic, expiry);\n  };\n\n  protected sendRequest: IAuthEngine[\"sendRequest\"] = async (topic, method, params, encodeOpts) => {\n    const payload = formatJsonRpcRequest(method, params);\n    const message = await this.client.core.crypto.encode(topic, payload, encodeOpts);\n    const rpcOpts = ENGINE_RPC_OPTS[method].req;\n    this.client.core.history.set(topic, payload);\n    await this.client.core.relayer.publish(topic, message, rpcOpts);\n\n    return payload.id;\n  };\n\n  protected sendResult: IAuthEngine[\"sendResult\"] = async (id, topic, result, encodeOpts) => {\n    const payload = formatJsonRpcResult(id, result);\n    const message = await this.client.core.crypto.encode(topic, payload, encodeOpts);\n    const record = await this.client.core.history.get(topic, id);\n    const rpcOpts = ENGINE_RPC_OPTS[record.request.method].res;\n\n    await this.client.core.relayer.publish(topic, message, rpcOpts);\n    await this.client.core.history.resolve(payload);\n\n    return payload.id;\n  };\n\n  protected sendError: IAuthEngine[\"sendError\"] = async (id, topic, params, encodeOpts) => {\n    const payload = formatJsonRpcError(id, params.error);\n    const message = await this.client.core.crypto.encode(topic, payload, encodeOpts);\n    const record = await this.client.core.history.get(topic, id);\n    const rpcOpts = ENGINE_RPC_OPTS[record.request.method].res;\n\n    await this.client.core.relayer.publish(topic, message, rpcOpts);\n    await this.client.core.history.resolve(payload);\n\n    return payload.id;\n  };\n\n  private isInitialized() {\n    if (!this.initialized) {\n      const { message } = getInternalError(\"NOT_INITIALIZED\", this.name);\n      throw new Error(message);\n    }\n  }\n\n  // ---------- Relay Events Router ----------------------------------- //\n\n  private registerRelayerEvents() {\n    this.client.core.relayer.on(\n      RELAYER_EVENTS.message,\n      async (event: RelayerTypes.MessageEvent) => {\n        const { topic, message } = event;\n\n        const receiverPublicKey = this.client.authKeys.keys.includes(AUTH_CLIENT_PUBLIC_KEY_NAME)\n          ? this.client.authKeys.get(AUTH_CLIENT_PUBLIC_KEY_NAME).publicKey\n          : \"\";\n\n        const opts = receiverPublicKey\n          ? {\n              receiverPublicKey,\n            }\n          : {};\n\n        const payload = await this.client.core.crypto.decode(topic, message, opts);\n        if (isJsonRpcRequest(payload)) {\n          this.client.core.history.set(topic, payload);\n          this.onRelayEventRequest({ topic, payload });\n        } else if (isJsonRpcResponse(payload)) {\n          await this.client.core.history.resolve(payload);\n          this.onRelayEventResponse({ topic, payload });\n        }\n      },\n    );\n  }\n\n  protected onRelayEventRequest: IAuthEngine[\"onRelayEventRequest\"] = (event) => {\n    const { topic, payload } = event;\n    const reqMethod = payload.method as JsonRpcTypes.WcMethod;\n\n    switch (reqMethod) {\n      case \"wc_authRequest\":\n        return this.onAuthRequest(topic, payload);\n      default:\n        return this.client.logger.info(`Unsupported request method ${reqMethod}`);\n    }\n  };\n\n  protected onRelayEventResponse: IAuthEngine[\"onRelayEventResponse\"] = async (event) => {\n    const { topic, payload } = event;\n    const record = await this.client.core.history.get(topic, payload.id);\n    const resMethod = record.request.method as JsonRpcTypes.WcMethod;\n\n    switch (resMethod) {\n      case \"wc_authRequest\":\n        return this.onAuthResponse(topic, payload);\n      default:\n        return this.client.logger.info(`Unsupported response method ${resMethod}`);\n    }\n  };\n\n  // ---------- Helpers ---------------------------------------------- //\n  protected constructEip4361Message = (cacao: AuthEngineTypes.CacaoPayload) => {\n    this.client.logger.debug(\"constructEip4361Message, cacao is:\", cacao);\n\n    const header = `${cacao.domain} wants you to sign in with your Ethereum account:`;\n    const walletAddress = getDidAddress(cacao.iss);\n    const statement = cacao.statement;\n    const uri = `URI: ${cacao.aud}`;\n    const version = `Version: ${cacao.version}`;\n    const chainId = `Chain ID: ${getDidChainId(cacao.iss)}`;\n    const nonce = `Nonce: ${cacao.nonce}`;\n    const issuedAt = `Issued At: ${cacao.iat}`;\n    const resources =\n      cacao.resources && cacao.resources.length > 0\n        ? `Resources:\\n${cacao.resources.map((resource) => `- ${resource}`).join(\"\\n\")}`\n        : undefined;\n\n    const message = [\n      header,\n      walletAddress,\n      ``,\n      statement,\n      ``,\n      uri,\n      version,\n      chainId,\n      nonce,\n      issuedAt,\n      resources,\n    ]\n      .filter((val) => val !== undefined && val !== null) // remove unnecessary empty lines\n      .join(\"\\n\");\n\n    return message;\n  };\n\n  // ---------- Relay Event Handlers --------------------------------- //\n\n  protected onAuthRequest: IAuthEngine[\"onAuthRequest\"] = async (topic, payload) => {\n    const {\n      requester,\n      payloadParams: { resources, statement, aud, domain, version, nonce, iat },\n    } = payload.params;\n\n    this.client.logger.debug(\"onAuthRequest:\", topic, payload);\n\n    try {\n      const cacaoPayload: AuthEngineTypes.CacaoPayload = {\n        iss: this.client.address || \"\",\n        aud,\n        domain,\n        version,\n        nonce,\n        iat,\n        statement,\n        resources,\n      };\n\n      const message = this.constructEip4361Message(cacaoPayload);\n\n      await this.client.requests.set(payload.id, {\n        requester,\n        id: payload.id,\n        message,\n        cacaoPayload,\n      });\n\n      this.client.emit(\"auth_request\", {\n        id: payload.id,\n        topic,\n        params: {\n          requester,\n          message: this.constructEip4361Message(cacaoPayload),\n        },\n      });\n    } catch (err: any) {\n      await this.sendError(payload.id, topic, err);\n      this.client.logger.error(err);\n    }\n  };\n\n  protected onAuthResponse: IAuthEngine[\"onAuthResponse\"] = async (topic, response) => {\n    const { id } = response;\n\n    this.client.logger.debug(\"onAuthResponse\", topic, response);\n\n    if (isJsonRpcResult(response)) {\n      const { pairingTopic } = this.client.pairingTopics.get(topic);\n      await this.client.core.pairing.activate({ topic: pairingTopic });\n\n      const { s: signature, p: payload } = response.result;\n      await this.client.requests.set(id, { id, ...response.result });\n      const reconstructed = this.constructEip4361Message(payload);\n      this.client.logger.debug(\"reconstructed message:\\n\", JSON.stringify(reconstructed));\n      this.client.logger.debug(\"payload.iss:\", payload.iss);\n      this.client.logger.debug(\"signature:\", signature);\n\n      const walletAddress = getDidAddress(payload.iss);\n      const chainId = getNamespacedDidChainId(payload.iss);\n\n      if (!walletAddress) {\n        throw new Error(\"Could not derive address from `payload.iss`\");\n      }\n      if (!chainId) {\n        throw new Error(\"Could not derive chainId from `payload.iss`\");\n      }\n      this.client.logger.debug(\"walletAddress extracted from `payload.iss`:\", walletAddress);\n\n      const isValid = await verifySignature(\n        walletAddress,\n        reconstructed,\n        signature,\n        chainId,\n        this.client.projectId,\n      );\n\n      if (!isValid) {\n        this.client.emit(\"auth_response\", {\n          id,\n          topic,\n          params: { message: \"Invalid signature\", code: -1 },\n        });\n      } else {\n        this.client.emit(\"auth_response\", { id, topic, params: response });\n      }\n    } else if (isJsonRpcError(response)) {\n      this.client.emit(\"auth_response\", { id, topic, params: response });\n    }\n  };\n}\n","import { Core, Store } from \"@walletconnect/core\";\nimport {\n  generateChildLogger,\n  getDefaultLoggerOptions,\n  getLoggerContext,\n} from \"@walletconnect/logger\";\nimport { EventEmitter } from \"events\";\nimport pino from \"pino\";\n\nimport { AuthClientTypes, IAuthClient } from \"./types\";\nimport { AuthEngine } from \"./controllers\";\nimport {\n  AUTH_CLIENT_PROTOCOL,\n  AUTH_CLIENT_STORAGE_PREFIX,\n  AUTH_CLIENT_VERSION,\n  AUTH_CLIENT_DEFAULT_NAME,\n} from \"./constants\";\n\nexport class AuthClient extends IAuthClient {\n  public readonly protocol = AUTH_CLIENT_PROTOCOL;\n  public readonly version = AUTH_CLIENT_VERSION;\n\n  public name: IAuthClient[\"name\"] = AUTH_CLIENT_DEFAULT_NAME;\n  public core: IAuthClient[\"core\"];\n  public metadata: IAuthClient[\"metadata\"];\n  public address: IAuthClient[\"address\"];\n  public projectId: IAuthClient[\"projectId\"];\n  public logger: IAuthClient[\"logger\"];\n  public events: IAuthClient[\"events\"] = new EventEmitter();\n  public engine: IAuthClient[\"engine\"];\n  public authKeys: IAuthClient[\"authKeys\"];\n  public pairingTopics: IAuthClient[\"pairingTopics\"];\n  public requests: IAuthClient[\"requests\"];\n\n  static async init(opts: AuthClientTypes.Options) {\n    const client = new AuthClient(opts);\n    await client.initialize();\n\n    return client;\n  }\n\n  constructor(opts: AuthClientTypes.Options) {\n    super(opts);\n\n    const logger =\n      typeof opts.logger !== \"undefined\" && typeof opts.logger !== \"string\"\n        ? opts.logger\n        : pino(\n            getDefaultLoggerOptions({\n              level: opts.logger || \"error\",\n            }),\n          );\n\n    this.name = opts?.name || AUTH_CLIENT_DEFAULT_NAME;\n    this.metadata = opts.metadata;\n    this.address = opts.iss;\n    this.projectId = opts.projectId;\n    this.core = opts.core || new Core(opts);\n    this.logger = generateChildLogger(logger, this.name);\n    this.authKeys = new Store(this.core, this.logger, \"authKeys\", AUTH_CLIENT_STORAGE_PREFIX);\n    this.pairingTopics = new Store(\n      this.core,\n      this.logger,\n      \"pairingTopics\",\n      AUTH_CLIENT_STORAGE_PREFIX,\n    );\n    this.requests = new Store(this.core, this.logger, \"requests\", AUTH_CLIENT_STORAGE_PREFIX);\n    this.engine = new AuthEngine(this);\n  }\n\n  get context() {\n    return getLoggerContext(this.logger);\n  }\n\n  // ---------- Events ----------------------------------------------- //\n\n  public emit: IAuthClient[\"emit\"] = (name, listener) => {\n    return this.events.emit(name, listener);\n  };\n\n  public on: IAuthClient[\"on\"] = (name, listener) => {\n    return this.events.on(name, listener);\n  };\n\n  public once: IAuthClient[\"once\"] = (name, listener) => {\n    return this.events.once(name, listener);\n  };\n\n  public off: IAuthClient[\"off\"] = (name, listener) => {\n    return this.events.off(name, listener);\n  };\n\n  public removeListener: IAuthClient[\"removeListener\"] = (name, listener) => {\n    return this.events.removeListener(name, listener);\n  };\n\n  // ---------- Engine ----------------------------------------------- //\n\n  // request wallet authentication\n  public request: IAuthClient[\"request\"] = async (params, opts) => {\n    try {\n      return await this.engine.request(params, opts);\n    } catch (error: any) {\n      this.logger.error(error.message);\n      throw error;\n    }\n  };\n\n  // respond wallet authentication\n  public respond: IAuthClient[\"respond\"] = async (params) => {\n    try {\n      return await this.engine.respond(params);\n    } catch (error: any) {\n      this.logger.error(error.message);\n      throw error;\n    }\n  };\n\n  public getPendingRequests: IAuthClient[\"getPendingRequests\"] = () => {\n    try {\n      return this.engine.getPendingRequests();\n    } catch (error: any) {\n      this.logger.error(error.message);\n      throw error;\n    }\n  };\n\n  // ---------- Private ----------------------------------------------- //\n\n  private async initialize() {\n    this.logger.trace(`Initialized`);\n    try {\n      await this.core.start();\n      await this.authKeys.init();\n      await this.requests.init();\n      await this.pairingTopics.init();\n      await this.engine.init();\n      this.logger.info(`AuthClient Initialization Success`);\n    } catch (error: any) {\n      this.logger.info(`AuthClient Initialization Failure`);\n      this.logger.error(error.message);\n      throw error;\n    }\n  }\n}\n","import { randomStringForEntropy } from \"@stablelib/random\";\n\n// Reference implementation:\n// https://github.com/spruceid/siwe/blob/38140330e54af91b1fab8ba1a8169e1fcbd8d271/packages/siwe/lib/utils.ts#L44\nexport function generateNonce(): string {\n  return randomStringForEntropy(96);\n}\n","import { AuthClient as Client } from \"./client\";\n\nexport * from \"./constants\";\nexport * from \"./types\";\nexport * from \"./utils/crypto\";\n\nexport const AuthClient = Client;\nexport default Client;\n"],"names":["client","opts","ONE_DAY","iss","segments","store","request","id","params","validAudience","isValidUrl","domainInAud","hasNonce","hasValidType","pendingResponses","getPendingRequest","address","reconstructedMessage","cacaoSignature","chainId","projectId","isValidEip191Signature","isValidEip1271Signature","message","signature","recoverAddress","hashMessage","eip1271MagicValue","dynamicTypeOffset","dynamicTypeLength","nonPrefixedSignature","nonPrefixedHashedMessage","data","response","fetch","DEFAULT_RPC_URL","generateJsonRpcId","result","error","IAuthEngine","ENGINE_RPC_OPTS","isValidRequest","statement","aud","domain","nonce","type","hasKnownPairing","pairing","relay","RELAYER_DEFAULT_PROTOCOL","expiry","calcExpiry","FIVE_MINUTES","publicKey","knownPairing","symKey","generateRandomBytes32","pairingTopic","AUTH_CLIENT_PUBLIC_KEY_NAME","responseTopic","hashKey","formatUri","respondParams","isValidRespond","pendingRequest","receiverPublicKey","senderPublicKey","encodeOpts","TYPE_1","cacao","__spreadValues","getPendingRequests","topic","method","payload","formatJsonRpcRequest","rpcOpts","formatJsonRpcResult","record","formatJsonRpcError","event","reqMethod","resMethod","header","walletAddress","getDidAddress","uri","version","getDidChainId","issuedAt","resources","resource","val","requester","iat","cacaoPayload","err","isJsonRpcResult","reconstructed","getNamespacedDidChainId","verifySignature","isJsonRpcError","getInternalError","RELAYER_EVENTS","isJsonRpcRequest","isJsonRpcResponse","AuthClient","IAuthClient","AUTH_CLIENT_PROTOCOL","AUTH_CLIENT_VERSION","AUTH_CLIENT_DEFAULT_NAME","EventEmitter","name","listener","logger","pino","getDefaultLoggerOptions","Core","generateChildLogger","Store","AUTH_CLIENT_STORAGE_PREFIX","AuthEngine","getLoggerContext","randomStringForEntropy","Client"],"mappings":"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"}